<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deface Mirror Archive</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="terminal">
        <div class="terminal-header">
            <div class="terminal-controls">
                <span class="control close"></span>
                <span class="control minimize"></span>
                <span class="control maximize"></span>
            </div>
            <span class="terminal-title">root@defacer:~</span>
        </div>
        
        <div class="terminal-body">
            <!-- Command Input -->
            <div class="command-line">
                <span class="prompt">$</span>
                <input type="text" id="commandInput" placeholder="add, search, list, clear" autofocus>
            </div>
            
            <!-- Output Area -->
            <div id="output"></div>
            
            <!-- Deface Table (Hidden by Default) -->
            <div id="defaceTableContainer" class="hidden">
                <table id="defaceTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>URL</th>
                            <th>Hacker</th>
                            <th>IP</th>
                            <th>Country</th>
                            <th>Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            
            <!-- Web Preview (Hidden by Default) -->
            <div id="webPreview" class="hidden">
                <div class="preview-header">
                    <span>Web Preview</span>
                    <button id="closePreview">âœ•</button>
                </div>
                <iframe id="previewFrame" sandbox="allow-same-origin"></iframe>
            </div>
        </div>
    </div>

    <script>
        // Data Storage
        let defaceData = JSON.parse(localStorage.getItem('defaceArchive')) || [];

        // DOM Elements
        const commandInput = document.getElementById('commandInput');
        const output = document.getElementById('output');
        const defaceTableContainer = document.getElementById('defaceTableContainer');
        const tableBody = document.getElementById('tableBody');
        const webPreview = document.getElementById('webPreview');
        const previewFrame = document.getElementById('previewFrame');
        const closePreview = document.getElementById('closePreview');

        // Initialize
        printWelcomeMessage();

        // Event Listeners
        commandInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') {
                processCommand(commandInput.value.trim());
                commandInput.value = '';
            }
        });

        closePreview.addEventListener('click', () => {
            webPreview.classList.add('hidden');
            defaceTableContainer.classList.remove('hidden');
        });

        // Command Processing
        function processCommand(cmd) {
            const args = cmd.split(' ');
            const command = args[0].toLowerCase();

            switch(command) {
                case 'add':
                    addDeface();
                    break;
                case 'search':
                    if (args.length < 2) {
                        printError("Usage: search [query]");
                    } else {
                        searchDeface(args.slice(1).join(' '));
                    }
                    break;
                case 'list':
                    listDeface();
                    break;
                case 'clear':
                    clearOutput();
                    break;
                case 'help':
                    printHelp();
                    break;
                default:
                    printError(`Command not found: ${command}`);
            }
        }

        // Commands
        function addDeface() {
            const url = prompt("Enter target URL:");
            if (!url) return;

            const hacker = prompt("Enter hacker/team name (optional):") || "Anonymous";

            fetch('https://ipapi.co/json/')
                .then(res => res.json())
                .then(ipInfo => {
                    const newEntry = {
                        id: Date.now(),
                        url,
                        hacker,
                        ip: ipInfo.ip,
                        country: ipInfo.country_name,
                        date: new Date().toISOString()
                    };

                    defaceData.unshift(newEntry);
                    localStorage.setItem('defaceArchive', JSON.stringify(defaceData));
                    printSuccess(`Added: ${url}`);
                    listDeface();
                })
                .catch(err => {
                    printError("Failed to fetch IP info. Using fallback data.");
                    const newEntry = {
                        id: Date.now(),
                        url,
                        hacker,
                        ip: "Unknown",
                        country: "Unknown",
                        date: new Date().toISOString()
                    };
                    defaceData.unshift(newEntry);
                    localStorage.setItem('defaceArchive', JSON.stringify(defaceData));
                    printSuccess(`Added: ${url}`);
                    listDeface();
                });
        }

        function searchDeface(query) {
            const results = defaceData.filter(entry => 
                entry.url.includes(query) || 
                entry.hacker.toLowerCase().includes(query.toLowerCase()) ||
                entry.ip.includes(query) ||
                entry.country.toLowerCase().includes(query.toLowerCase())
            );

            if (results.length === 0) {
                printError("No results found.");
                return;
            }

            renderTable(results);
            printSuccess(`Found ${results.length} matches.`);
        }

        function listDeface() {
            if (defaceData.length === 0) {
                printError("No deface records found.");
                return;
            }
            renderTable(defaceData);
            printSuccess(`Showing ${defaceData.length} records.`);
        }

        // Rendering
        function renderTable(data) {
            tableBody.innerHTML = '';
            data.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${entry.id}</td>
                    <td><a href="${entry.url}" target="_blank">${entry.url}</a></td>
                    <td>${entry.hacker}</td>
                    <td>${entry.ip}</td>
                    <td>${entry.country}</td>
                    <td>${new Date(entry.date).toLocaleString()}</td>
                    <td><button class="view-btn" data-url="${entry.url}">View</button></td>
                `;
                tableBody.appendChild(row);
            });

            // Add event listeners to view buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const url = btn.getAttribute('data-url');
                    previewFrame.src = url;
                    defaceTableContainer.classList.add('hidden');
                    webPreview.classList.remove('hidden');
                });
            });

            defaceTableContainer.classList.remove('hidden');
            webPreview.classList.add('hidden');
        }

        // Output Functions
        function printWelcomeMessage() {
            output.innerHTML += `
                <div class="output-line">
                    <span class="prompt">$</span> 
                    <span>Welcome to Deface Mirror Archive</span>
                </div>
                <div class="output-line">
                    <span class="prompt">$</span> 
                    <span>Type <span class="command">help</span> for available commands</span>
                </div>
            `;
        }

        function printHelp() {
            output.innerHTML += `
                <div class="output-line">
                    <span class="prompt">$</span> 
                    <span>Available commands:</span>
                </div>
                <div class="output-line">
                    <span class="prompt">></span> 
                    <span class="command">add</span> - Add new deface entry
                </div>
                <div class="output-line">
                    <span class="prompt">></span> 
                    <span class="command">search [query]</span> - Search deface records
                </div>
                <div class="output-line">
                    <span class="prompt">></span> 
                    <span class="command">list</span> - List all deface records
                </div>
                <div class="output-line">
                    <span class="prompt">></span> 
                    <span class="command">clear</span> - Clear terminal
                </div>
            `;
        }

        function printSuccess(message) {
            output.innerHTML += `
                <div class="output-line success">
                    <span class="prompt">$</span> 
                    <span>${message}</span>
                </div>
            `;
            scrollToBottom();
        }

        function printError(message) {
            output.innerHTML += `
                <div class="output-line error">
                    <span class="prompt">$</span> 
                    <span>${message}</span>
                </div>
            `;
            scrollToBottom();
        }

        function clearOutput() {
            output.innerHTML = '';
        }

        function scrollToBottom() {
            output.scrollTop = output.scrollHeight;
        }
    </script>
</body>
</html>
